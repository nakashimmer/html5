<!DOCTYPE html>
<meta charset="utf-8">
<title>requestAnimationFrame API</title>
<meta name=viewport content="width=500,user-scalable=no">
<style>
	*{margin:0;padding:0;
		font-size:20px;
	}
	#wrap{width:500px;
		margin:0 auto;
	}
	p{
		text-align:right;
		border:1px solid gray;
		border-bottom:none;
		padding:5px;
	}
	p:last-of-type{
		border-bottom:1px solid gray;
	}
	button{margin:5px;}
</style>

<div id=wrap>
	<h1>requestAnimationFrame API</h1>
	<button id=start>スタート</button>
	<button id=stop>ストップ</button>
	<p id=now>秒</p>
	<p id=i>回</p>
	<p id=ps>％</p>
	<canvas width=500 height=10 id=canvas></canvas>
</div>

<script>
$("start").addEventListener("click",loopStart);
$("stop").addEventListener("click",loopStop);

var i;
var myLoop;
var startTime;
var c=$("canvas").getContext("2d");
$("stop").disabled="disabled";

function loopStart(){
	if(window.performance && performance.now){
		startTime=performance.now();
		i=0;
		$("start").disabled=true;
		$("stop").disabled=false;
		loop();
	}
}


function loop(){
	myLoop=requestAnimationFrame(loop);
	var now=performance.now()-startTime;
	$("now").innerHTML=(now/1000).toFixed(20)+"秒経過";
	$("i").innerHTML=i+"回";
	i++;
	$("ps").innerHTML="一秒間に"+(i/(now/1000)).toFixed(20)+"回";
	c.fillStyle="blue";
	c.clearRect(0,0,500,10);
	c.fillRect(0,0,i%500,10);
}

function loopStop(){
	window.cancelAnimationFrame(myLoop); 
	$("start").disabled=false;
	$("stop").disabled=true;
}

function $(id){
	return document.getElementById(id);
}
</script>
</body>
</html>