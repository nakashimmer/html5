<!DOCTYPE html>
<meta charset="utf-8">
<title>synthesizer</title>
<meta name=viewport content="width=device-width">
<style>
*{margin:0;padding:0;font-size:20px;color:white;}
#wrap{width:900px;margin:50px auto;padding:5px;background-color:#aaa;}
#board1,#board2{display:flex;}
.keys{
	text-align:center;
	width:50px;height:90px;
	margin:3px;
	color:black;
	background-color:white;
}
.keys:last-of-type{
}
h1{
	font-size:1.5em;
	line-height:2em;
	text-align:center;
	color:white;
}
p{line-height:2em;}
section{
}
#key-1{margin-left:35px;}
#key-6{margin-left:55px;}
#key-13{margin-left:65px;}
#key-18{margin-left:55px;}
#key-25{margin-left:55px;}
</style>

<section id=wrap>
	<h1>WebAudio API</h1>
	<p>音量：<input id=vol type="range" min=0 max=1 value=0.5 step=0.1></p>
	<p>波形：
		<label><input type="radio" name="wstyle" value="sine" checked>正弦波</label> 
		<label><input type="radio" name="wstyle" value="square">矩形波</label> 
		<label><input type="radio" name="wstyle" value="triangle">三角波</label> 
		<label><input type="radio" name="wstyle" value="sawtooth">のこぎり波</label>
	</p>
	<p>鍵盤：</p>
	<div id=board1></div>
	<div id=board2></div>

</section>

<script>
var str="";
var kname=[
	"c<br>z",
	"c#<br>s",
	"d<br>x",
	"d#<br>d",
	"e<br>c",
	"f<br>v",
	"f#<br>g",
	"g<br>b",
	"g#<br>h",
	"a<br>n",
	"a#<br>j",
	"b<br>m",
	"C<br>q",
	"C#<br>2",
	"D<br>w",
	"D#<br>3",
	"E<br>e",
	"F<br>r",
	"F#<br>5",
	"G<br>t",
	"G#<br>6",
	"A<br>y",
	"A#<br>7",
	"B<br>u",
	"CC<br>i",
	"CC#<br>9"
]

for(var i=0;i<kname.length;i++){
	if(0<kname[i].indexOf("#")){
		str+="<div class=keys id=key-"+i+">"+kname[i]+"</div>";
	}
}

$("board1").innerHTML=str;

str="";
for(var i=0;i<kname.length;i++){
	if(kname[i].indexOf("#")<0){
		str+="<div class=keys id=key-"+i+">"+kname[i]+"</div>";
	}
}
$("board2").innerHTML=str;

var hz=[
	261.63,	//c
	277.18,	//c#
	293.66,	//d
	311.13,	//d#
	329.63,	//e
	349.23,	//f
	369.99,	//f#
	392,	//g
	415.3,	//g#
	440,	//a
	466.16,	//a#
	493.88,	//b	
	
	523.25,	//cc
	554.37,	//cc#
	587.33,	//dd
	622.25,	//dd#
	659.26,	//ee
	698.46,	//ff
	739.99,	//ff#
	783.99,	//gg
	830.61,	//gg#
	880,	//aa
	932.33,	//aa#
	987.77,	//bb	
	1046.5,	//ccc
	1108.73,//ccc#
];

var ac=new AudioContext(); //音の元を作る
var vcg=ac.createGain(); //ボリュームを作る
var vco=new Array()
for(var i=0;i<hz.length;i++){
 vco[i]=ac.createOscillator(); //音源を作る
 vco[i].connect(vcg); //音源をボリュームにつなぐ
 vco[i].type="sine"; //音色
 vco[i].frequency.value=hz[i];
}
vcg.connect(ac.destination); //出力につなぐ

var Code=[
	90,//z-c
	83,//s-c#
	88,//x-d
	68,//d-d#
	67,//c-e
	86,//v-f
	71,//g-f#
	66,//b-g
	72,//h-g#
	78,//n-a
	74,//j-a#
	77,//m-b
	
	81,//q-cc
	50,//2-cc#
	87,//w-dd
	51,//3-dd#
	69,//e-ee
	82,//r-ff
	53,//5-ff#
	84,//t-gg
	54,//6-gg#
	89,//y-aa
	55,//u-aa#
	85,//i-bb
	73,//i-ccc
	57//9-ccc#
];

window.addEventListener("keydown",kdown);

function kdown(e){
	var i = Code.indexOf(e.keyCode);

	vcg.gain.value=$("vol").value; //音量
	var wstyle = document.getElementsByName("wstyle");
	for(var w=0;w<wstyle.length;w++){
		if (wstyle[w].checked) {
			vco[i].type=wstyle[w].value; //音色
		}
	}
	$("key-"+i).style.backgroundColor="black";
	$("key-"+i).style.color="white";
	vco[i].start();
	f=false;

}

window.addEventListener("keyup",kup);

function kup(e){
	var i = Code.indexOf(e.keyCode);

		vco[i].stop();
		vco[i]=ac.createOscillator(); //音源を作る
		vco[i].connect(vcg); //音源をボリュームにつなぐ
		vco[i].frequency.value=hz[i];
		$("key-"+i).style.backgroundColor="white";
		$("key-"+i).style.color="black";
}

function $(id){return document.getElementById(id);}

</script>

</body>
</html>