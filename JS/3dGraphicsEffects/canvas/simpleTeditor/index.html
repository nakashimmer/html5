<!DOCTYPE html>
<meta charset=utf-8>
<title>入力</title>
<style>
	*{margin:0;padding:0;font-size:25px;box-sizing:border-box;}
	#wrap{width:90%;margin:10px auto;}
	#outer{
		height:500px;		/*高さが狭い時はこの数字を変更する*/
		overflow:scroll;
		border:1px solid gray;padding:5px;
	}
	#editor{
		height:5000px;width:100%;
		display:block;
		line-height:30px;
		padding:0em;
		font-family:sans-serif;
		tab-size:4;
		background:linear-gradient(white 50%,#eee 50%);
		background-size:auto 60px;
		border:none;
		outline:none;
	}
	p{margin:10px 0;}
	button,a{border:1px solid gray;background-color:#eee;
		displey:block;width:30%;height:4em;margin:1px;}
	.flex{display :flex;}
	.btn{font-size:13px;}
	#btn{background-color:skyblue;width:90%;}
	.temp{background-color:yellow;}
	#clrbtn{background-color:pink;}
	#msg{font-size:0.5em;}
	h1{font-size:0.5em;background-color:#999;color:white;text-align:center;}
	#download{display:block;line-height:50px;text-decoration:none;text-align:center;background-color:#aaa;color:white;}
</style>
<script type="text/javascript" src="jquery-1.11.1.js"></script>
<div id=wrap>
	<h1>簡易テキストエディタβ版</h1>
	<div id=outer>
		<textarea id=editor contenteditable></textarea>
	</div>
	<p class=flex>
		<button id="btn" class="btn">別窓閲覧</button>
		<a class="temp btn" id="download" href="#" download="noname.html" onclick="dl()">DL</a>
		<button id="temp1" class="temp btn">マークアップ</button>
		<button id="temp2" class="temp btn">CSS<wbr>①②</button>
		<button id="temp3" class="temp btn">CSS<wbr>③④⑤ JS③</button>
		<button id="temp4" class="temp btn">JS①②</button>
		<button id="clrbtn" class="btn">ソース消去</button>
	</p>
	
	<!-- DL -->
	<script>
		function dl() {
			var content = $id("editor").value;
			var blob = new Blob([ content ],{"type":"text/plain"});
			$id("download").href = window.URL.createObjectURL(blob);
		}
	</script>
	
	<!-- /DL -->
</div>


<script>
var content=localStorage.getItem("editor_contents");
if(content){$id("editor").value=content;}

$id("btn").addEventListener("click",function(){
	var editor = $id("editor");
	editor =editor.value;
	var w = window.open("","sample");
	var doc=w.document;
	doc.open();
	doc.write(editor);
	doc.close();
});

$id("editor").addEventListener("mousemove",function(){
	localStorage.setItem("editor_contents",$id("editor").value);
});

$id("clrbtn").addEventListener("click",function(){
	localStorage.clear();
	editor.value="";
});


$id("temp1").addEventListener("click",function(){
	$id("editor").value
=`<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>タイトル</title>
	</head>
	<body>

	</body>
</html>`;
});

$id("temp2").addEventListener("click",function(){
	$id("editor").value
=`<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>タイトル</title>
		<style>

		</style>
	</head>
	<body>

	</body>
</html>`;
});

$id("temp3").addEventListener("click",function(){
	$id("editor").value
=`<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>タイトル</title>
		<style>
			#box1{
				width:200px;height:200px;margin:50px auto;
				line-height:200px;text-align:center;
				border:1px solid gray;
			}

			#box1{
			}
		</style>
	</head>
	<body>
		<div id="box1">CSS3デザイン</div>
	</body>
</html>`;
});

$id("temp4").addEventListener("click",function(){
	$id("editor").value
=`<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>タイトル</title>
		<style>
		</style>
	</head>
	<body>

		<sc`+`ript>
		
		</sc`+`ript>
	</body>
</html>`;
});


function $id(id){
	return document.getElementById(id);
}

$(function(){
$("textarea").on('keydown', function(e){
	// tabキー押下時の対応
	if (e.which == 9 || e.keyCode == 9) {
		e.preventDefault();
		var pos = this.selectionStart;
		var text = $(this).val();
		// tabの挿入
		$(this).val(text.substr(0,pos) + '\t' + text.substr(pos, text.length));
		// カーソルの場所を移動
		this.setSelectionRange(pos + 1, pos + 1);
		}
	});
});

</script>




