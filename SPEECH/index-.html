<!DOCTYPE html>
<meta charset="utf-8">
<title>音声入力と読み上げ</title>
<meta name=viewport content="width=device-width,user-scalable=no">
<style>
	*{margin:0;padding:0;font-size:20px;}
	section{width:320px;display:block;margin:0 auto;}
	#input{width:100%;height:100px;padding:5px;}
	h1{font-size:1.5em;text-align:center;}
	p{margin:0.5em;}
	li{margin-left:1em;}
	button,select{
		border-radius:5px;
		height:2em;
		border:1px solid gray;
		background-color:#eee;
		padding:0 0.5em;
	}
</style>

<section>
	<h1>音声入力と読み上げ</h1>
	<ol>
		<li>
			<p>録音または入力<br>
			<select id=lang>
				<option value="ja-JP">日本語</option>
				<option value="en-US">英語</option>
			</select>
			<button onclick="nyuryoku();">音声入力</button></p>
			<p><textarea id=input>
こんにちは。
東京アプリ・ワークショップです。</textarea></p>
		<li>
			<p><button onclick="mySpeech();">読み上げます</button></p>
		</li>
	</ol>
</section>

<script>
	//再生
	function mySpeech(){
		var lang = document.getElementById("lang").value;
		var input = document.getElementById("input").value;
		var input = new SpeechSynthesisUtterance(input);
		input.lang = lang;
		var voices = speechSynthesis.getVoices();
		input.voice = voices[2];
		speechSynthesis.speak(input);
	}


	//録音
	function nyuryoku(){
		window.SpeechRecognition = window.SpeechRecognition;
// || webkitSpeechRecognition;
		var recognition = new webkitSpeechRecognition();
		var lang = document.getElementById("lang").value;
		recognition.lang = lang;
		recognition.start();
		// 録音終了時トリガー
		recognition.addEventListener('result', function(e){
			var rec = e.results.item(0).item(0).transcript;
			rec=rec.replace("中島","イケメン中島");
			rec=rec.replace("なかしま","イケメン中島");
			document.getElementById("input").value=	rec;
			setTimeout(mySpeech,1000);
		});
	}
</script>
