<!DOCTYPE html>
<meta charset="utf-8">
<title>音声入力と読み上げ</title>
<meta name=viewport content="width=device-width">
<style>
	*{margin:0;padding:0;font-size:20px;}
	section{width:320px;display:block;margin:0 auto;}
	#input{width:100%;height:100px;padding:5px;}
	h1{font-size:1.5em;text-align:center;}
	p{margin:0.5em;}
	li{margin-left:1em;}
	button,select{
		border-radius:5px;
		height:2em;
		border:1px solid gray;
		background-color:#eee;
		padding:0 0.5em;
	}
</style>

<section>
	<h1>音声入力と読み上げ</h1>
	<ol>
		<li>
			
			<p id=voices><button onclick="voice();">音声データ選択</button></p>
		</li>

		<li>
			<p>録音または入力<br>
			<select id=lang>
				<option value="ja-JP">日本語</option>
				<option value="en-US" selected>英語</option>
			</select>
			<button onclick="nyuryoku();">音声入力</button></p>
			<p><textarea id=input>
I have a pen.
			</textarea></p>
		<li>
			<p><button onclick="mySpeech();">読み上げます</button></p>
		</li>
	</ol>
</section>

<script>

	//ボイスの種類

	var voices = speechSynthesis.getVoices();

	function voice(){
		voices = speechSynthesis.getVoices();
			var length=voices.length;
			var voiceStr="音声データ<br><select id=voice>";
			console.log(length);
			
			for(var i=0;i<length;i++){
				if(voices[i]){
					voiceStr+="<option value="+i+">"+voices[i].name+"</option>";
					
				}
			}
			voiceStr+="</select>";
			
			$id("voices").innerHTML=voiceStr;

	}

	//再生
	function mySpeech(){
		var input = $id("input").value;
		var voice = parseInt($id("voice").value);
		var input = new SpeechSynthesisUtterance(input);
		var lang = $id("lang").value
		input.lang = lang;
		var voices = speechSynthesis.getVoices();
		input.voice = voices[voice];
		speechSynthesis.speak(input);
	}


	//録音
	function nyuryoku(){
		window.SpeechRecognition = window.SpeechRecognition;
		var recognition = new webkitSpeechRecognition();
		var lang = $id("lang").value
		recognition.lang = lang;
		recognition.start();
		// 録音終了時トリガー
		recognition.addEventListener('result', function(e){
			var rec = e.results.item(0).item(0).transcript;
			
			rec=rec.replace("中島","イケメン中島");
			rec=rec.replace("なかしま","イケメン中島");
			
			var now=new Date();
			rec=rec.replace("何時",now.getHours()+"時"+now.getMinutes()+"分です");

			$id("input").value=	rec;
			setTimeout(mySpeech,1000);
		});
	}
	
	function $id(id){return document.getElementById(id);}
</script>
