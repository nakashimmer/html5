<!DOCTYPE html>
<meta charset=utf-8>
<title>入力</title>
<style>
*{margin:0;padding:0;font-size:25px;}
#wrap{width:90%;margin:10px auto;}
#outer{
	height:500px;		/*高さが狭い時はこの数字を変更する*/
	overflow:scroll;
	border:1px solid gray;padding:5px;
}
#editor{
	height:5000px;width:100%;
	display:block;
	line-height:30px;
	padding:0em;
	font-family:sans-serif;
	tab-size:4;
	background:linear-gradient(white 50%,#eee 50%);
	background-size:auto 60px;
	border:none;
	outline:none;
}
p{margin:10px 0;}
button{border:1px solid gray;background-color:#eee;displey:block;width:50%;margin:20px;}
.flex{display :flex;}
#btn{background-color:skyblue;width:200%;}
#temp{background-color:yellow;}
#clrbtn{background-color:pink;}


</style>
<script type="text/javascript" src="jquery-1.11.1.js"></script>
<div id=wrap>
	<p>
	<div id=outer>
		<textarea id=editor contenteditable></textarea>
	</div>
	<p class=flex>
		<button id="btn" class=left>出力</button>
		<button id="temp" class=left>テンプレート</button>
		<button id="clrbtn" class=right>ソース消去</button>
	</p>
</div>

<script>
var content=localStorage.getItem("editor_contents");
if(content){$id("editor").value=content;}

$id("btn").addEventListener("click",function(){
	var editor = $id("editor");
	editor =editor.value;
	var w = window.open("","sample");
	var doc=w.document;
	doc.open();
	doc.write(editor);
	doc.close();
});

$id("editor").addEventListener("mousemove",function(){
	localStorage.setItem("editor_contents",$id("editor").value);
});

$id("clrbtn").addEventListener("click",function(){
	localStorage.clear();
	editor.value="";
});


$id("temp").addEventListener("click",function(){
	$id("editor").value
		='<!DOCTYPE html>'+'\n'
		+'<html>'+'\n'
		+'	<head>'+'\n'
		+'		<meta charset="utf-8">'+'\n'
		+'		<title>タイトル</title>'+'\n'
		+'		<style>'+'\n\n'
		+'			#box1{width:200px;height:200px;margin:50px auto;'+'\n'
		+'				line-height:200px;text-align:center;'+'\n'
		+'				border:1px solid gray;'+'\n'
		+'			}'+'\n'
		+'		</style>'+'\n'
		+'	</head>'+'\n'
		+'	<body>'+'\n'
		+'		<div id="box1">リッチなデザイン</div>'+'\n'
		+'	</body>'+'\n'
		+'</html>'+'\n'
});


function $id(id){
	return document.getElementById(id);
}

$(function(){
$("textarea").on('keydown', function(e){
	// tabキー押下時の対応
	if (e.which == 9 || e.keyCode == 9) {
		e.preventDefault();
		var pos = this.selectionStart;
		var text = $(this).val();
		// tabの挿入
		$(this).val(text.substr(0,pos) + '\t' + text.substr(pos, text.length));
		// カーソルの場所を移動
		this.setSelectionRange(pos + 1, pos + 1);
		}
	});
});

</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3233827-70', 'auto');
  ga('send', 'pageview');

</script>

