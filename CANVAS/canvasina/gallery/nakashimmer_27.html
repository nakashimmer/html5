<!DOCTYPE html>
<meta charset=utf-8>
<meta name="viewport" content="width=500">
<title>Merry Xmas! created by nakashimmer | Canvasina is HTML5 art scripting gallery</title>
<meta name=description content="Merry Xmas! created by nakashimmer | Canvasina.com is HTML5 art scripting gallery">
<link href="../canvasina/canvasina.css" rel=stylesheet>
<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<!-- for  facebook like button -->
<div id="fb-root"></div>
<script>
(function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0];if(d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1&appId=141558212660855";
  fjs.parentNode.insertBefore(js, fjs);}(document, 'script', 'facebook-jssdk'));
</script>
<!-- facebook like button -->

<section id=wrap>
	
	<section>
		<canvas id=canvasina width=500 height=450>
			Sorry, Your browser is not chrome ,safari.
			<img src=http://canvasina.com/img/icon.png height=225><br>
			<img src=http://canvasina.com/galleryImg/nakashimmer_27.png height=225>
		</canvas>
	
	</section>

	<header>
		Merry Xmas!
	</header>

	<footer>
		<a href="http://www.facebook.com/nakashimmer" target=_blank>created by Shunji Nakashima</a>
		<a href="/" ><h1>Canvasina</h1></a>
		
		<a id=share href="https://www.facebook.com/sharer/sharer.php?u=http://canvasina.com/gallery/nakashimmer_27.html" target="_blank">Share</a>

		<!-- a id=share name="fb_share" type="button_count" share_url="http://canvasina.com/gallery/nakashimmer_27.html"></a>
		<script src="http://static.ak.fbcdn.net/connect.php/js/FB.Share" type="text/javascript"></script -->
		
		<div id=like style="" class="fb-like" data-href="http://canvasina.com/gallery/nakashimmer_27.html" data-width="100" 
		data-colorscheme="dark" data-layout="button_count" data-show-faces="false" data-send="false"></div>
		
	</footer>	
</section>

<script src="../canvasina/canvasina.js"></script>
<script>
var frame = 0; 
var target = {x:250, y:380, dir:1};
var player = {x:250, y:100};
var ballMax=50;
var ball = new Array(ballMax);
//i個のボールの位置を順番にセッティングする
for(var i=0;i<ballMax;i++){ball[i]={x:-10, y:1000};}
var ballNo=0;

var star=new Array(200);
for(var i=0;i<star.length;i++){
 star[i]={
  x:Math.floor(Math.random()*canvas.width),
  y:Math.floor(Math.random()*canvas.height/1.5)}
}

var music=0;

//★画像と音の取り込み
var url="http://springreen.jp/INDEX/themes/ShunsuiKobo/bg/12/"
var ufo=new Image();ufo.src=url+"child.png";
var plane=new Image();plane.src=url+"santa.png";
var wave=new Image();wave.src=url+"present.png";

var bomb=new Audio();
bomb.src="http://springreen.jp/INDEX/themes/ShunsuiKobo/bg/amclassical_the_first_noel.mp3";

var point = 0;
var p={x:0,y:0};
var g=c.createLinearGradient(0,0,0,canvas.height);
g.addColorStop(0,"darkblue");
g.addColorStop(1,"black");

var timer=setInterval(anime,50);

function anime(){	
 frame++;						
 //画面をクリア
 c.fillStyle=g;
 c.fillRect(0,0,canvas.width,canvas.height);

 //ハート
 c.globalAlpha=0.5;
 for(var i=0;i<point;i++){
  p.x=i%40/40*(canvas.width-5)+5;
  p.y=450-10-Math.floor(i/40)*10;
  c.beginPath();
  c.save();
  c.translate(p.x,p.y);
  c.rotate(Math.cos(frame/8)/20*pi);
  c.moveTo(-3,-3);
  c.lineTo(0,0);
  c.lineTo(3,-3);
  c.strokeStyle="pink";
  c.lineWidth=5;
  c.lineCap="round";
  c.stroke();
  c.restore();
 } 
 c.globalAlpha=0.1;

 //Merry Xmas
 c.fillStyle=(bomb.duration<bomb.currentTime+10)?"red":"White";
 c.globalAlpha=bomb.currentTime/bomb.duration;
 c.font="80px serif";
 c.fillText("Merry Xmas",10,200);
 c.globalAlpha=1;
 if(bomb.duration==bomb.currentTime){
  bomb.pause();clearInterval(timer);
 }

 c.fillStyle="white";
 for(var i=0;i<star.length;i++){
  c.globalAlpha=Math.random();
  c.beginPath();
  c.arc(star[i].x,star[i].y,1,0,2*pi,false);
  c.fill();
 }
 c.globalAlpha=1;

 //★targetを描画
 c.save();
 c.translate(target.x,target.y);
 c.rotate(Math.cos(frame/8)/45*pi);
 c.drawImage(ufo,-30,-30,60,60);
 c.restore();
        
 //得点表示
 c.fillStyle = "white";
 c.font = "10px sans-serif";
 c.fillText(point,p.x-5,p.y-10);
	
 //★playerを描画
 c.drawImage(
   plane,
   player.x-30,
   player.y-30+Math.sin(frame/18*pi)*10,60,60);

 //ballを描画
 for(var i=0;i<ballMax;i++){
  ball[i].x += Math.floor(Math.random()*5)-2;
  c.drawImage(wave,ball[i].x-15,ball[i].y-30,30,30);
 }

 //移動計算
 target.x += target.dir;
 for(var i=0;i<ballMax;i++){ball[i].y += 5;}

 //壁衝突計算
 if(target.x < 25 || canvas.width-25 < target.x)target.dir *= -1; 
	
 //得点ゲット
 for(var i=0;i<ballMax;i++){
  if ((target.y+30 == ball[i].y) &&
   (Math.abs(target.x - ball[i].x)<45)){
   point++;
   ball[i].x=-100;

  //★音を「最初から」「再生」する
  //bomb.currentTime=0;
  bomb.play();       
  }
 }
}
	
//シュートする関数
canvas.addEventListener("mousemove",function(e){
 var rect = e.target.getBoundingClientRect();
 player.x = e.clientX - rect.left;					 
 //	player.y = e.clientY- rect.top;

});
canvas.addEventListener("mousedown",function(e){
 ball[ballNo].x = player.x;
 ball[ballNo].y = player.y+30;
 ballNo++;
 if(ballMax<=ballNo){ballNo=0;} 
});
	
//★タッチの動きを補足する
canvas.addEventListener("touchmove",function(e){
 e.preventDefault();
 var rect = e.target.getBoundingClientRect();
 player.x = e.touches[0].clientX - rect.left;		
  //	player.y = e.clientY- rect.top;	
 if(frame%5==0){
  frame++;
  ball[ballNo].x = player.x;
  ball[ballNo].y = player.y+60;
  ballNo++;
  if(ballMax<=ballNo){ballNo=0;} 
 }
});

//★スマフォでは最低一回、プレイヤが音をだす動作をしなければ音は出ません
var ini=true;
function soundIni(){
 if(ini){bomb.play();ini=false;
 }
}
</script>

<script type="text/javascript">
if (window==parent){
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3233827-64']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
}
</script>
