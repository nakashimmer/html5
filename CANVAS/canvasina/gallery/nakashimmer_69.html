<!DOCTYPE html>
<meta charset=utf-8>
<meta name="viewport" content="width=500">
<title>午年パズル created by nakashimmer | Canvasina is HTML5 art scripting gallery</title>
<meta name=description content="午年パズル created by nakashimmer | Canvasina.com is HTML5 art scripting gallery">
<link href="../canvasina/canvasina.css" rel=stylesheet>
<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<!-- for  facebook like button -->
<div id="fb-root"></div>
<script>
(function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0];if(d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1&appId=141558212660855";
  fjs.parentNode.insertBefore(js, fjs);}(document, 'script', 'facebook-jssdk'));
</script>
<!-- facebook like button -->

<section id=wrap>
	
	<section>
		<canvas id=canvasina width=500 height=450>
			Sorry, Your browser is not chrome ,safari.
			<img src=http://canvasina.com/img/icon.png height=225><br>
			<img src=http://canvasina.com/galleryImg/nakashimmer_69.png height=225>
		</canvas>
	
	</section>

	<header>
		午年パズル
	</header>

	<footer>
		<a href="http://www.facebook.com/nakashimmer" target=_blank>created by Shunji Nakashima</a>
		<a href="/" ><h1>Canvasina</h1></a>
		
		<a id=share href="https://www.facebook.com/sharer/sharer.php?u=http://canvasina.com/gallery/nakashimmer_69.html" target="_blank">Share</a>

		<!-- a id=share name="fb_share" type="button_count" share_url="http://canvasina.com/gallery/nakashimmer_69.html"></a>
		<script src="http://static.ak.fbcdn.net/connect.php/js/FB.Share" type="text/javascript"></script -->
		
		<div id=like style="" class="fb-like" data-href="http://canvasina.com/gallery/nakashimmer_69.html" data-width="100" 
		data-colorscheme="dark" data-layout="button_count" data-show-faces="false" data-send="false"></div>
		
	</footer>	
</section>

<script src="../canvasina/canvasina.js"></script>
<script>
//msg
var msg=new Array(4);
msg[0]=new Array(4);
msg[0][0]={str:"あ",bg:"white",color:"red",cover:"white"};
msg[0][1]={str:"け",bg:"red",color:"white",cover:"red"};
msg[0][2]={str:"ま",bg:"white",color:"red",cover:"white"};
msg[0][3]={str:"し",bg:"red",color:"white",cover:"red"};
msg[1]=new Array(4);    
msg[1][0]={str:"て",bg:"red",color:"white",cover:"red"};
msg[1][1]={str:"お",bg:"white",color:"red",cover:"white"};
msg[1][2]={str:"め",bg:"red",color:"white",cover:"red"};
msg[1][3]={str:"で",bg:"white",color:"red",cover:"white"};
msg[2]=new Array(4);
msg[2][0]={str:"と",bg:"white",color:"red",cover:"white"};
msg[2][1]={str:"う",bg:"red",color:"white",cover:"red"};
msg[2][2]={str:"ご",bg:"white",color:"red",cover:"white"};
msg[2][3]={str:"ざ",bg:"red",color:"white",cover:"red"};
msg[3]=new Array(4);    
msg[3][0]={str:"い",bg:"red",color:"white",cover:"red"};
msg[3][1]={str:"ま",bg:"white",color:"red",cover:"white"};
msg[3][2]={str:"す",bg:"red",color:"white",cover:"red"};
msg[3][3]={str:"！",bg:"white",color:"red",cover:"white"}; 

var remain=30;
var knight={x:-0.2,y:-0};
var bgm=new Audio("http://springreen.jp/INDEX/themes/ShunsuiKobo/bg/harunoumi.mp3");
//初期画面
boardDraw();

c.save();
c.scale(3,3);
knightDraw();
c.restore();
//初期メッセージ
c.fillStyle="white";
c.globalAlpha=0.7;
c.fillRect(0,0,canvas.width,canvas.height);
c.globalAlpha=1;
c.fillStyle="black";
c.font="20px serif";
c.fillText("新年あけましておめでとうございます",250,100);
c.fillText("今年は午年。馬といえばチェスのナイト",250,150);
c.fillText("ナイトを動かして全ての枠を開きましょう",250,200);
c.fillText("ナイトはななめ２つ向こうにしか動けません",250,250);
c.fillText("制限時間は30秒",250,300);
c.fillText("用意ができたら画面をクリック！",250,350);
c.font="10px serif";
c.fillText("音素材提供: http://www.tam-music.com/",250,380);
if(canvas.getBoundingClientRect().left>0){
bgm.play();
}
//ゲーム画面
var interval=true;
var timer;
canvas.addEventListener("mouseup",function(e){
     if(interval){
      timer=setInterval(anime,100);
      interval=false;
      knight={
            x:Math.floor(Math.random()*4),
            y:Math.floor(Math.random()*4)
            };
      }
});

function anime(){
    //clear
    c.clearRect(0,0,canvas.width,canvas.height);
    boardDraw();
    knightDraw();
    remainDraw();
    checker();
}
  
function boardDraw(){
    //盤面作成
    c.fillStyle="blue";
    c.font="100px serif";
    c.textAlign="center";
    for(var i=0;i<4;i++){
            for(var j=0;j<4;j++){
                c.fillStyle=msg[i][j].bg;
                c.fillRect(j*100+50,i*100+25,100,100);         
                c.fillStyle=msg[i][j].color;
                c.fillText(msg[i][j].str,j*100+100,i*100+115);
                c.fillStyle=msg[i][j].cover;
                c.fillRect(j*100+50,i*100+25,100,100);   
            }
    } 
}
  
function knightDraw(){
    //knight
    c.save();
    c.translate(knight.x*100+100,knight.y*100+75);
    c.scale(0.8,1);
    c.beginPath();
    c.fillStyle="black";
    c.moveTo(0,-45);
    c.quadraticCurveTo(-50,-30,-30,30);
    c.arc(-25,40,10,1.3*Math.PI,0.7*Math.PI,true);
    c.arc(25,40,10,0.3*Math.PI,1.7*Math.PI,true);
    c.quadraticCurveTo(40,20,30,10);  
    c.quadraticCurveTo(0,0,0,-20);  
    c.quadraticCurveTo(0,0,45,-10); 
    c.lineTo(48,-15);
    c.lineTo(40,-20);
    c.quadraticCurveTo(20,-50,10,-45); 
    c.lineTo(10,-50);
    c.closePath();
    c.globalAlpha=0.4;
   c.fill();
    c.globalAlpha=0.5;
c.strokeStyle="black";
c.lineWidth=3;
 c.stroke();
    c.restore();
       c.globalAlpha=1;
}
  
function checker(){
    //完了チェック
    var  check=0;
    for(var i=0;i<4;i++){
            for(var j=0;j<4;j++){  
                if(msg[i][j].cover=="transparent"){check++;}
            }
    }
    if(remain<=0){
        clearInterval(timer);
        c.fillStyle="white";
        c.globalAlpha=0.5;
        c.fillRect(0,0,canvas.width,canvas.height);
        c.globalAlpha=1;
        c.fillStyle="black";
        c.font="50px serif";
        c.fillText("おしい！",250,250);
bgm.pause();
    }

    if(check>=16){
        clearInterval(timer);
        c.fillStyle="white";
        c.globalAlpha=0.7;
        c.fillRect(0,0,canvas.width,canvas.height);
        c.fillStyle="black";
        c.globalAlpha=1;
       c.font="150px serif";
        c.fillText("寿",250,200); 
       c.font="30px serif";
        c.fillText("やったね ",250,250);
        c.fillText("今年はいいことがあるはず ",250,300);
        c.fillText("みんなにシェアしてね ",250,350);
bgm.pause();
    }
}

function remainDraw(){
    remain -=0.1;
    if(remain>0){
        c.fillStyle="skyblue";
        c.font="50px sans-serif";
        c.globalAlpha=0.8;
        c.fillText(Math.floor(remain),250,250);
        c.globalAlpha=1;
    }
}

canvas.addEventListener("mousedown",function(e){
    var rect = e.target.getBoundingClientRect();
    var tempX	= Math.floor((e.clientX - rect.left-50)/100);
    var tempY	= Math.floor((e.clientY - rect.top-25)/100);
    if((Math.abs(knight.x-tempX)==1 && Math.abs(knight.y-tempY)==2)||(Math.abs(knight.y-tempY)==1 && Math.abs(knight.x-tempX)==2)){
          knight.x=tempX;
          knight.y=tempY;  
          msg[knight.y][knight.x].cover="transparent";
    }
});

</script>

<script type="text/javascript">
if (window==parent){
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3233827-64']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
}
</script>
