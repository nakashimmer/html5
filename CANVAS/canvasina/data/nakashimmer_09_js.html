var frame=0;
var maimai={x:100,y:300,dx:3,dy:3};
var point=0;

var ame = new Array(100);
for(var i=0;i<300;i++){
 ame[i]={x:i*10+500,
 y:floor(random(700))-400}
}

window.onload=function(){setInterval(anime,50);}
function anime(){
 frame++;
//背景
 var g=c.createLinearGradient(0,0,0,500);
  g.addColorStop(0, 'violet');      
  g.addColorStop(1 , 'white');
  $cls(g);
 
 //$txt("point:"+point,50,400,30,black,arial);
  
//水滴
 c.fillStyle="lightblue";
 for(var i=0;i<100;i++){
  c.beginPath();
  c.moveTo(ame[i].x,ame[i].y-20);
  c.arc(ame[i].x,ame[i].y,20,pi,2*pi,true);
  c.closePath();
  c.fill();

// 得点
  if(abs(ame[i].x-maimai.x)<30 
  && abs(ame[i].y-maimai.y)<10){
   point++; ame[i].x=-100;}
   ame[i].x--;
   if(ame[i].x<400){ame[i].y++;}
  }

//かたつむり
  c.strokeStyle="black";
  maimai.x +=maimai.dx;
  maimai.y +=maimai.dy;
  if(maimai.x<90 || maimai.x>470){
   maimai.dx *=-1;}
  if(maimai.y<50 || maimai.y>410){
   maimai.dy *=-1;}
//胴体
  $3(maimai.x,maimai.y,
        maimai.x-90,maimai.y+40+sin(frame)*5,
        maimai.x-10,maimai.y+40-sin(frame)*5
  ,pink);
  c.stroke();

//目
  $2(maimai.x,maimai.y,
    maimai.x,maimai.y-40,black);
   
  $2(maimai.x,maimai.y,
    maimai.x+20,maimai.y-40,black); 
//目
  $1(maimai.x,maimai.y-40,10,white);
  c.stroke();
  $1(maimai.x+20,maimai.y-40,10,white);
  c.stroke();
//目玉
  $1(maimai.x-5+maimai.x/500*10,
    maimai.y-5-40+maimai.y/450*10,
    5,black);
  $1(maimai.x-5+20+maimai.x/500*10,
    maimai.y-5-40+maimai.y/450*10,
    5,black);

//殻
 $1(maimai.x-50,maimai.y,40,brown);
 c.stroke();
 c.beginPath();
 c.arc(maimai.x-50,maimai.y,25,1/2*pi,0,false);
 c.stroke();
}

canvas.onmousemove = function(e){  
 var rect = e.target.getBoundingClientRect();
 maimai.dx=2;
 maimai.dy=2;
 if(maimai.x - (e.clientX - rect.left)>=0){
  maimai.dx*=-1;}
 if(maimai.y - (e.clientY- rect.top)>=-1){
  maimai.dy*=-1;}
};