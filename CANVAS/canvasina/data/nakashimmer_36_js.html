color(black);
box(0,0,width,height);
var frame=0;
var HANABI = new Array(40);
var sound = new Array(40);
for(i=0;i<40;i++){
 var r=random(256);
 var g=random(256);
 var b=random(256);
 if(r===0 && g===0 && b===0)
  {r=215;g=215;b=215;}
 HANABI[i]={
  x:0,
  y:-100,
  dy:0,
  color:"rgb("+r+","+g+","+b+")"
 };

if($("canvasina").getBoundingClientRect().left>0){
 sound[i]= new Audio("http://springreen.jp/INDEX/themes/ShunsuiKobo/bg/fc.mp3");}
}
var k=0;

function random(n){
 return Math.floor(Math.random()*n);
}

var bgcolor="black";
color(bgcolor);
setInterval(anime,30);

function anime(){
 frame++;
 if(random(100)<4)fire();
 c.globalAlpha = 0.15;
 color(bgcolor);
 box(0,0,500,500);
 bgcolor="black";
    
 for(j=0;j<40;j++){
  c.globalAlpha = 0.5;
  c.fillStyle = "white";
  box(HANABI[j].x,HANABI[j].y,3,10);
        
  c.globalAlpha = 1;
  HANABI[j].y-=2;
  if(HANABI[j].y==100){
   HANABI[j].y=-100;
   HANABI[j].dy=1;
   sound[j].play();
   bgcolor="white";
 }
	
 if(HANABI[j].dy==300){HANABI[j].dy=0;}	
 if(HANABI[j].dy>0){
  HANABI[j].dy++;
  for(var i=0;i<36;i++){
   circle(
    HANABI[j].x-sin(i*10)*HANABI[j].dy,
    100-cos(i*10)*HANABI[j].dy+HANABI[j].dy/3,
    2);
   fill(HANABI[j].color);
   }
  }
 }
var g=c.createLinearGradient(-50,0,200,0);
g.addColorStop(0,"#000"); 
 g.addColorStop(((frame/2)%60+20)/100-0.2,"#000");
 g.addColorStop(((frame/2)%60+20)/100,"#5ddaf8");
 g.addColorStop(((frame/2)%60+20)/100+0.2,"#000");
g.addColorStop(1,"#000"); 

var g1=c.createLinearGradient(-50,0,200,0);
g1.addColorStop(0,"#000"); 
 g1.addColorStop(1-(frame%60+20)/100-0.2,"#000");
 g1.addColorStop(1-(frame%60+20)/100,"white");
 g1.addColorStop(1-(frame%60+20)/100+0.2,"#000");
g1.addColorStop(1,"#000"); 

var g2=c.createLinearGradient(0,0,0,500);
g2.addColorStop(0,"#000"); 
g2.addColorStop(0.3,"gold"); 
g2.addColorStop(0.5,"#000"); 
g2.addColorStop(0.55,"gold"); 
g2.addColorStop(0.7,"#000"); 
g2.addColorStop(1,"gold"); 


color(g2);
box(70,95,10,50);
box(60,150,30,100);
box(50,260,50,200);

color(g1);
box(58,145,36,5);
box(47,250,56,10);

color("black");
box(300,420,150,100);
circle(350,370,50);
fill("black");	
tri(440,330,380,340,380,410);
fill("black");		
}

function fire(){
 HANABI[k].x = floor(Math.random()*400)+50;
 HANABI[k].y = 450;
 k++;
 if(k>=40)k=0;
}