<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>お絵かきアプリ</title>
	<meta name="viewport" content="width=320,user-scalable=no">
	<style>
	*{margin:0;padding:0;font-size:0;}
	p,button{font-size:20px;}
	canvas{background-color:#eee;}
	#wrap{margin:0 auto;width:320px;}
	button{width:20%;border:0;}
	</style>
</head>

<body>

<div id="wrap">
	<canvas id="mycanvas" width="320" height="320"></canvas>
	
	<p>線の太さ<input type=range min=0 max=30 value=10 id=lineWidth></p>

	<p>透 明 度<input type=range min=0 max=10 value=5 id=Alpha></p>

	<button onclick="mouse.color='black';finger[0].color='black'">黒</button>

	<button onclick="mouse.color='red';finger[0].color='red'">赤</button>
	
<button onclick="mouse.color='green';finger[0].color='green'">緑</button>
	
	<button onclick="mouse.color='blue';finger[0].color='blue'">青</button>
	
	<button onclick="c.clearRect(0,0,320,320)">クリア</button>
</div>

<script>
	//最初の設定
	function $(id){return document.getElementById(id)}
	var canvas = $("mycanvas");
	var c = canvas.getContext("2d");

	//1.PC(マウス)で操作
	var mouse = {x:0,y:0,x1:0,y1:0,color:"black"};
	var myDraw = false;
	//1-1マウスが動いたら描画
	canvas.addEventListener("mousemove",function(e){
		c.lineWidth = $("lineWidth").value;
		c.globalAlpha = $("Alpha").value/10;
		var rect = e.target.getBoundingClientRect();
		mouse.x = e.clientX - rect.left;
		mouse.y = e.clientY - rect.top;
		c.strokeStyle=mouse.color;
		
		//1-2ただしmyDrawがtrueの場合のみ
		if(myDraw){
			c.beginPath();
			c.moveTo(mouse.x1,mouse.y1);
			c.lineTo(mouse.x,mouse.y);
			c.lineCap="round";
			c.stroke();
			mouse.x1=mouse.x;
			mouse.y1=mouse.y;
		}
	});
	
	//1-2.マウスを押している間、描画を許可(myDrawをtrue)
	canvas.addEventListener("mousedown",function(e){
		myDraw=true; mouse.x1=mouse.x; mouse.y1=mouse.y
	});
	
	//1-2.マウスを話すと、描画を禁止(myDrawをfalse)
	canvas.addEventListener("mouseup",function(e){
		myDraw=false;
	});

	//2.タッチで操作
	var finger=new Array;
	for(var i=0;i<10;i++){
		finger[i]={
			x:0,y:0,x1:0,y1:0,
			color:"rgb("
			+Math.floor(Math.random()*16)*15+","
			+Math.floor(Math.random()*16)*15+","
			+Math.floor(Math.random()*16)*15
			+")"
		};
	}

	//2-1.タッチした瞬間座標を取得
	canvas.addEventListener("touchstart",function(e){
		e.preventDefault();
		var rect = e.target.getBoundingClientRect();
		for(var i=0;i<finger.length;i++){
			finger[i].x1 = e.touches[i].clientX-rect.left;
			finger[i].y1 = e.touches[i].clientY-rect.top;
		}
	});

	//2-2.タッチして動き出したら描画
	canvas.addEventListener("touchmove",function(e){
		e.preventDefault();
		c.lineWidth=$("lineWidth").value;
		var rect = e.target.getBoundingClientRect();
		for(var i=0;i<finger.length;i++){
			finger[i].x = e.touches[i].clientX-rect.left;
			finger[i].y = e.touches[i].clientY-rect.top;
			c.strokeStyle=finger[i].color;
			c.beginPath();
			c.moveTo(finger[i].x1,finger[i].y1);
			c.lineTo(finger[i].x,finger[i].y);
			c.lineCap="round";
			c.stroke();
			finger[i].x1=finger[i].x;
			finger[i].y1=finger[i].y;
		}
	});

</script>
</body>
</html>
