<!DOCTYPE html>
<meta charset="utf-8">
<title>synthesizer</title>
<meta name=viewport content="width=device-width">
<style>
*{margin:0;padding:0;font-size:20px;}
#wrap{width:500px;margin:50px auto;}
#board{display:flex;width:500px;}
.keys{
	border:2px solid black;
	border-right:none;
	text-align:center;
	width:50px;height:90px;
}
.keys:last-of-type{
	border-right:2px solid black;
}
h1{
	font-size:1.5em;
	line-height:2em;
	text-align:center;
	background:linear-gradient(gray,white);
}
p{line-height:2em;}
section{
	background:linear-gradient(white 90%,gray);
}
</style>

<section id=wrap>
	<h1>WebAudio API</h1>
	<p>音量：<input id=vol type="range" min=0 max=1 value=0.5 step=0.1></p>
	<p>波形：
		<label><input type="radio" name="wstyle" value="sine" checked>正弦波</label> 
		<label><input type="radio" name="wstyle" value="square">矩形波</label> 
		<label><input type="radio" name="wstyle" value="triangle">三角波</label> 
		<label><input type="radio" name="wstyle" value="sawtooth">のこぎり波</label>
	</p>
	<p>鍵盤：</p>
	<div id=board></div>

</section>

<script>
var str="";
var kname=["C<br>1","D<br>2","E<br>3","F<br>4","G<br>5","A<br>6","B<br>7","C<br>8","D<br>9","E<br>0","F<br>ー","G<br>^","A<br>￥"]
for(var i=0;i<13;i++){
	str+="<div class=keys id=key-"+i+">"+kname[i]+"</div>";
}
$("board").innerHTML=str;

var hz=[
	523.251,
	587.330,
	659.255,
	698.456,
	783.991,
	880,
	987.767,
	1046.502,
	1174.659,
	1318.510,
	1396.913,
	1567.982,
	1760
];

var ac=new AudioContext(); //音の元を作る
var vcg=ac.createGain(); //ボリュームを作る
var vco=new Array()
for(var i=0;i<hz.length;i++){
 vco[i]=ac.createOscillator(); //音源を作る
 vco[i].connect(vcg); //音源をボリュームにつなぐ
 vco[i].type="sine"; //音色
 vco[i].frequency.value=hz[i];
}
vcg.connect(ac.destination); //出力につなぐ

var Code=[49,50,51,52,53,54,55,56,57,48,189,187,0];

window.addEventListener("keydown",kdown);

function kdown(e){
	var i = Code.indexOf(e.keyCode);
	vcg.gain.value=$("vol").value; //音量
	var wstyle = document.getElementsByName("wstyle");
	for(var w=0;w<wstyle.length;w++){
		if (wstyle[w].checked) {
			vco[i].type=wstyle[w].value; //音色
		}
	}
	$("key-"+i).style.backgroundColor="black";
	$("key-"+i).style.color="white";
	vco[i].start();
}

window.addEventListener("keyup",kup);

function kup(e){
	var i = Code.indexOf(e.keyCode);
	vco[i].stop();
	vco[i]=ac.createOscillator(); //音源を作る
	vco[i].connect(vcg); //音源をボリュームにつなぐ
	vco[i].frequency.value=hz[i];
	$("key-"+i).style.backgroundColor="transparent";
	$("key-"+i).style.color="black";
}

function $(id){return document.getElementById(id);}

</script>

</body>
</html>